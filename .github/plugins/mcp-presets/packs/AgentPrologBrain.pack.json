{
  "$schema": "../schemas/pack.schema.json",
  "id": "AgentPrologBrain",
  "name": "Prolog Brain Pack",
  "version": "3.0.0",
  "description": "Pack completo para agentes con razonamiento Prolog. Incluye 12 tools, 6 resources y 8 prompts para workflows E2E.",
  "author": "Aleph Scriptorium",
  "license": "AIPL-1.0",
  
  "mcpServer": {
    "id": "prolog-mcp-server",
    "port": 3006,
    "source": "MCPGallery/mcp-mesh-sdk",
    "startCommand": "npm run start:prolog"
  },
  
  "tools": [
    {
      "name": "prolog_create_session",
      "description": "Crear sesión Prolog para una obra Teatro",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string", "description": "ID único de sesión" },
          "obraId": { "type": "string", "description": "ID de la obra Teatro" }
        },
        "required": ["sessionId", "obraId"]
      }
    },
    {
      "name": "prolog_query",
      "description": "Ejecutar consulta Prolog (e.g., 'member(X, [1,2,3]).')",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string" },
          "query": { "type": "string", "description": "Query Prolog a ejecutar" }
        },
        "required": ["sessionId", "query"]
      }
    },
    {
      "name": "prolog_assert_fact",
      "description": "Añadir hecho a la base de conocimiento",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string" },
          "fact": { "type": "string", "description": "Hecho Prolog (e.g., 'likes(mary, wine)')" }
        },
        "required": ["sessionId", "fact"]
      }
    },
    {
      "name": "prolog_consult_file",
      "description": "Cargar archivo .pl en la sesión",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string" },
          "filePath": { "type": "string", "description": "Ruta al archivo .pl" }
        },
        "required": ["sessionId", "filePath"]
      }
    },
    {
      "name": "prolog_destroy_session",
      "description": "Destruir sesión y liberar recursos",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string" }
        },
        "required": ["sessionId"]
      }
    },
    {
      "name": "prolog_list_sessions",
      "description": "Listar todas las sesiones activas"
    },
    {
      "name": "prolog_get_templates",
      "description": "Obtener catálogo de templates Prolog disponibles"
    },
    {
      "name": "prolog_load_rules_from_db",
      "description": "Cargar reglas persistidas de SQLite a la KB de sesión",
      "inputSchema": {
        "type": "object",
        "properties": {
          "sessionId": { "type": "string", "description": "Sesión destino" },
          "app": { "type": "string", "description": "Filtrar por app (opcional)" }
        },
        "required": ["sessionId"]
      }
    },
    {
      "name": "prolog_save_rule_to_db",
      "description": "Persistir una regla Prolog en SQLite",
      "inputSchema": {
        "type": "object",
        "properties": {
          "name": { "type": "string", "description": "Nombre de la regla" },
          "content": { "type": "string", "description": "Contenido Prolog" },
          "app": { "type": "string", "description": "Aplicación (opcional)" }
        },
        "required": ["name", "content"]
      }
    },
    {
      "name": "prolog_list_sdk_templates",
      "description": "Listar templates SDK disponibles en backend"
    },
    {
      "name": "prolog_get_sdk_template_content",
      "description": "Obtener contenido de un template SDK específico",
      "inputSchema": {
        "type": "object",
        "properties": {
          "templateName": { "type": "string", "description": "Nombre del template" }
        },
        "required": ["templateName"]
      }
    },
    {
      "name": "prolog_get_telemetry_status",
      "description": "Obtener estado de telemetría/sensores del backend"
    }
  ],
  
  "resources": [
    {
      "uri": "prolog://sessions/current",
      "name": "prolog-session-state",
      "description": "Estado actual de la sesión Prolog incluyendo metadata",
      "mimeType": "application/json"
    },
    {
      "uri": "prolog://templates/catalog",
      "name": "prolog-templates-catalog", 
      "description": "Templates Prolog disponibles para agentes Teatro",
      "mimeType": "application/json"
    },
    {
      "uri": "prolog://sessions",
      "name": "prolog-active-sessions",
      "description": "Lista de sesiones Prolog activas",
      "mimeType": "application/json"
    },
    {
      "uri": "prolog://rules/catalog",
      "name": "prolog-rules-catalog",
      "description": "Catálogo de reglas Prolog persistidas en SQLite",
      "mimeType": "application/json"
    },
    {
      "uri": "prolog://sdk/templates",
      "name": "prolog-sdk-templates",
      "description": "Templates SDK disponibles en backend storage",
      "mimeType": "application/json"
    },
    {
      "uri": "prolog://telemetry/current",
      "name": "prolog-telemetry",
      "description": "Estado actual de telemetría IoT/sensores",
      "mimeType": "application/json"
    }
  ],
  
  "prompts": [
    {
      "name": "session_lifecycle",
      "description": "Gestionar ciclo de vida de sesión Prolog (crear, listar, destruir)",
      "arguments": [
        { "name": "action", "description": "Acción: create, list, destroy", "required": true },
        { "name": "sessionId", "description": "ID de sesión (para create/destroy)", "required": false },
        { "name": "obraId", "description": "ID de obra Teatro (para create)", "required": false }
      ]
    },
    {
      "name": "load_knowledge_base",
      "description": "Cargar conocimiento Prolog desde archivo o base de datos",
      "arguments": [
        { "name": "source", "description": "Fuente: file o database", "required": true },
        { "name": "sessionId", "description": "ID de sesión destino", "required": true },
        { "name": "path", "description": "Ruta archivo (si source=file)", "required": false },
        { "name": "app", "description": "Filtro app (si source=database)", "required": false }
      ]
    },
    {
      "name": "interactive_query",
      "description": "Ejecutar consultas Prolog interactivas con contexto de sesión",
      "arguments": [
        { "name": "sessionId", "description": "ID de sesión activa", "required": true },
        { "name": "queryType", "description": "Tipo: simple, findall, aggregate", "required": false }
      ]
    },
    {
      "name": "persist_rule",
      "description": "Guardar reglas Prolog en sesión o base de datos",
      "arguments": [
        { "name": "target", "description": "Destino: session o database", "required": true },
        { "name": "sessionId", "description": "ID sesión (si target=session)", "required": false },
        { "name": "ruleName", "description": "Nombre regla (si target=database)", "required": false }
      ]
    },
    {
      "name": "use_sdk_template",
      "description": "Explorar y aplicar templates SDK de Prolog",
      "arguments": [
        { "name": "action", "description": "Acción: list o get", "required": true },
        { "name": "templateName", "description": "Nombre template (para get)", "required": false }
      ]
    },
    {
      "name": "telemetry_check",
      "description": "Verificar estado de telemetría IoT/sensores",
      "arguments": []
    },
    {
      "name": "razonamiento_sbr",
      "description": "Ejecutar razonamiento basado en sensores (SBR) con Prolog",
      "arguments": [
        { "name": "sessionId", "description": "Sesión con reglas SBR cargadas", "required": true },
        { "name": "objetivo", "description": "Objetivo del razonamiento", "required": true }
      ]
    },
    {
      "name": "teatro_agent_session",
      "description": "Workflow E2E completo para agente Teatro con razonamiento Prolog",
      "arguments": [
        { "name": "obraId", "description": "ID de la obra Teatro", "required": true },
        { "name": "agentName", "description": "Nombre del agente (e.g., 'lucas')", "required": true }
      ]
    }
  ],
  
  "contextTriggers": {
    "keywords": ["prolog", "regla", "inferencia", "lógica", "query", "sbr", "razonamiento", "sesión"],
    "filePatterns": ["*.pl", "*prolog*", "*brain*", "*rules*"],
    "domains": ["teatro", "arg", "razonamiento", "iot", "sbr"]
  },
  
  "examples": {
    "sessionWorkflow": [
      "1. prolog_create_session({sessionId: 'lucas-itaca', obraId: 'itaca-digital'})",
      "2. prolog_consult_file({sessionId: 'lucas-itaca', filePath: 'lucas-prolog.brain.pl'})",
      "3. prolog_load_rules_from_db({sessionId: 'lucas-itaca', app: 'itaca-digital'})",
      "4. prolog_query({sessionId: 'lucas-itaca', query: 'decidir_accion(lucas, Accion).'})",
      "5. prolog_destroy_session({sessionId: 'lucas-itaca'})"
    ],
    "promptWorkflow": [
      "1. Prompt: teatro_agent_session con obraId='itaca-digital', agentName='lucas'",
      "2. Seguir instrucciones generadas por el prompt",
      "3. El prompt orquesta todas las tools necesarias"
    ],
    "sbrWorkflow": [
      "1. prolog_get_telemetry_status() - obtener datos de sensores",
      "2. prolog_load_rules_from_db({sessionId: 'sbr-session', app: 'sbr'})",
      "3. Prompt: razonamiento_sbr con objetivo específico"
    ]
  }
}
